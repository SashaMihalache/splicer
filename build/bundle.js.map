{"version":3,"file":"bundle.js","sources":["../src/splicer/buffer-loader.js","../src/splicer/engine.js","../src/main.js"],"sourcesContent":["class BufferLoader {\n  constructor(context, urlList, callback) {\n    this.context = context;\n    this.urlList = urlList;\n    this.isDone = callback;\n    this.bufferList = [];\n    this.loadCount = 0;\n\n    this.init();\n  }\n\n  init() {\n    for (let i = 0; i < this.urlList.length; ++i) {\n      this.loadBuffer(this.urlList[i], i);\n    }\n  }\n\n  loadBuffer(url, index) {\n    fetch(url)\n      .then(body => {\n\n        body.arrayBuffer()\n          .then(buffer => {\n\n            this.context.decodeAudioData(buffer, (audio) => {\n              if (!audio) alert('Error decoding file data: ' + url);\n\n              this.bufferList[index] = audio;\n\n              // when all buffers are loaded and decoded, callback\n              if (++this.loadCount == this.urlList.length) {\n                this.isDone(this.bufferList);\n              }\n            }\n            )\n          })\n          .catch(err => console.log('Error buffering', err));\n      })\n      .catch(err => {\n        alert('Buffer Loader : Fetch Error');\n      })\n  }\n\n}\n\nexport default BufferLoader;","import BufferLoader from './buffer-loader';\n\nclass Engine {\n  constructor(tempo, sequenceMatrix) {\n    this.tempo = tempo;\n    this.sequenceMatrix = sequenceMatrix;\n    this.context = null;\n    this.init();\n  }\n\n  init() {\n    try {\n      this.context = new AudioContext();\n    }\n    catch (e) {\n      alert(\"Web Audio API is not supported in this browser\", e);\n    }\n\n    const sampleListURL = Object.keys(this.sequenceMatrix);\n\n    new BufferLoader(\n      this.context,\n      sampleListURL,\n      (bufferList) => this.finishLoadingBuffers(bufferList)\n    );\n  }\n\n  playSound(sample, time) {\n    var source = this.context.createBufferSource();\n    source.buffer = sample.buffer;\n    source.connect(this.context.destination);\n    if (!source.start) {\n      source.start = source.noteOn;\n    }\n    source.start(time);\n  }\n\n  finishLoadingBuffers(bufferList) {\n    const trackList = []\n\n    bufferList.forEach(audio => {\n      const track = this.context.createBufferSource();\n      track.buffer = audio;\n      track.connect(this.context.destination);\n      trackList.push(track);\n    })\n\n    this.playPattern(trackList);\n  }\n\n  playPattern(trackList) {\n    const sixteenthNoteTime = (60 / this.tempo) / 4;\n    const MEASURE = 16;\n\n    const matrixKeys = Object.keys(this.sequenceMatrix);\n    const matrixValues = matrixKeys.map(key => this.sequenceMatrix[key]);\n    const MEASURE_LENGTH = matrixValues[0].length;\n\n    let time = 0;\n    for (let beat = 0; beat < MEASURE_LENGTH; beat++) {\n      let pauseCounter = 0;\n      for (let trackIndex = 0; trackIndex < matrixKeys.length; trackIndex++) {\n        const currentValue = matrixValues[trackIndex][beat];\n        if (currentValue === 'x') {\n          this.playSound(trackList[trackIndex], time);\n        } else {\n          pauseCounter++;\n        }\n\n        if (pauseCounter === matrixKeys.length) {\n          time += sixteenthNoteTime;\n        }\n      }\n\n      time += sixteenthNoteTime;\n    }\n  }\n}\n\nexport default Engine;\n\n  // pattern 8th\n  // 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\n  // k x   -   -   -   x   -   -   - \n  // s -   -   x   -   -   -   x   -\n  // h x   x   x   x   x   x   x   x\n\n  // k x - - - - - - - x - - - - - - - \n  // s - - - - x - - - - - - - x - - -\n  // h x - x - x - x - x - x - x - x -\n  // pattern 16th\n  // <------------------------------> measure (1 measure = 4 beats = 8 8ths notes)\n  // <------><------><------><------> beat (1beat = 4 8th notes)\n  // <><><><><><><><><><><><><><><><> 8th","import Engine from './splicer/engine';\nlet bufferLoader;\nconst playButton = document.querySelector('button');\n\nconst sequenceMatrix = {\n  \"src/audio/kick.wav\": ['x', '-', '-', 'x', '-', 'x', 'x', ''],\n  \"src/audio/snare.wav\": ['-', '-', '-', '-', 'x', '-', '-', '-'],\n  \"src/audio/hihat.wav\": ['-', '-', 'x', '-', '-', '-', 'x', '-'],\n}\n\nplayButton.addEventListener('click', handlePlayClick);\n\nfunction handlePlayClick() {\n  new Engine(120, sequenceMatrix); //BPM and samplelist\n}\n"],"names":[],"mappings":"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"}